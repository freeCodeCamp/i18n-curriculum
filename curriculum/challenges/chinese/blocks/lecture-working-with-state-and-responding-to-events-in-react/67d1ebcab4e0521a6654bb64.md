---
id: 67d1ebcab4e0521a6654bb64
title: 如何更新状态中的数组？
challengeType: 19
dashedName: how-do-you-update-arrays-in-state
---

# --description--

在 React 中，更新状态中的数组非常简单，但如果你来自可以直接修改数组的原生 JavaScript，可能很容易出错。

在 React 中，state 被视为不可变的，因此它可以识别更改并对用户界面进行适当的更新。

让我们看看你如何更新 React 状态中保存的数组。

在 React 状态中更新数组时，最常见的错误之一是直接使用 `push()`、`pop()` 或 `splice()` 等方法修改数组。这些方法会改变原始数组，而 React 不允许这样做。

React 依赖新的数组引用来检测变化，因此直接修改数组可能会阻止组件按预期重新渲染。

这是一个使用 `push()` 方法为状态中的数组添加元素的示例，但这样做不起作用：

```jsx
import { useState } from "react";

function ItemsList() {
  const [items, setItems] = useState([
    { id: 0, name: "Item 1" },
    { id: 1, name: "Item 2" },
    { id: 2, name: "Item 3" },
  ]);

  const addItem = () => {
    const newItem = { id: items.length + 1, name: `Item ${items.length + 1}` };
    items.push(newItem); // This modifies the original array
    setItems(items); // React will not detect this change
  };

  return (
    <div>
      <button onClick={addItem}>Add Item</button>
      <ul>
        {items.map((item) => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
    </div>
  );
}

export default ItemsList;
```

如果你点击 `Add Item` 按钮，用户界面中不会有任何反应。

使用 `pop()` 方法从数组中移除项也可能很诱人：

```js
const removeItem = () => {
  items.pop(); // Modifies the original array
  setItems(items); // React will not detect this change, either
};
```

要更新状态中的数组，关键是创建一个新数组，执行你的操作，然后将其传递给 React，而不是修改现有的数组。

因为它是一个新建数组，React 会知道状态已更改，并触发重新渲染。

以下是如何使用展开操作符为 `items` 数组添加内容的方法：

```js
const addItem = () => {
  const newItem = {
    id: items.length + 1,
    name: `Item ${items.length + 1}`,
  };

  // Creates a new array
  setItems((prevItems) => [...prevItems, newItem]);
};
```

`[...prevItems, newItem]` 通过拷贝状态中现有的 `items` 数组中的所有项来创建一个新数组，然后在末尾添加 `newItem`，这会递增 `id` 和项编号。

如果你想从数组中移除某些内容，可以使用 `filter()` 方法，该方法在过滤掉你想移除的内容后返回一个新数组：

```js
const removeItem = (id) => {
  setItems((prevItems) => prevItems.filter((item) => item.id !== id));
};
```

这是完整的代码：

```jsx
import { useState } from "react";

function ItemsList() {
  const [items, setItems] = useState([
    { id: 0, name: "Item 1" },
    { id: 1, name: "Item 2" },
    { id: 2, name: "Item 3" },
  ]);

  const addItem = () => {
    const newItem = { id: items.length + 1, name: `Item ${items.length + 1}` };
    setItems((prevItems) => [...prevItems, newItem]); // Creates a new array
  };

  const removeItem = (id) => {
    setItems((prevItems) => prevItems.filter((item) => item.id !== id)); // Creates a new array
  };

  return (
    <div>
      <button onClick={addItem}>Add Item</button>
      <ul>
        {items.map((item) => (
          <li key={item.id}>
            {item.name}{" "}
            <button onClick={() => removeItem(item.id)}>Remove</button>
          </li>
        ))}
      </ul>
    </div>
  );
}

export default ItemsList;
```

这些是你可以更新状态中数组的一些常见方法。

# --questions--

## --text--

以下哪种方法是更新状态并为数组添加新项的正确方式？

## --answers--

```js
setItems(copy [prevItems, newItem]);
```

### --feedback--

要更新状态中的数组，你需要使用 setter 函数和为数组添加新项的正确语法。

---

```js
setItems(new Array = [...prevItems, newItem]);
```

### --feedback--

要更新状态中的数组，你需要使用 setter 函数和为数组添加新项的正确语法。

---

```js
items = (prevItems) => [...prevItems, newItem];
```

### --feedback--

要更新状态中的数组，你需要使用 setter 函数和为数组添加新项的正确语法。

---

```js
setItems((prevItems) => [...prevItems, newItem]);
```

## --video-solution--

4

## --text--

为什么你不应该直接修改 React 状态中的数组？

## --answers--

它会自动清空数组。

### --feedback--

React 依赖不可变性来检测状态的变化。

---

它会向数组添加不需要的副本。

### --feedback--

React 依赖不可变性来检测状态的变化。

---

它会导致组件中的误差。

### --feedback--

React 依赖不可变性来检测状态的变化。

---

它防止 React 检测变化。

## --video-solution--

4

## --text--

在 React 状态中，从数组中移除一项的最佳方法是哪一个？

## --answers--

`splice()`

### --feedback--

考虑一个创建新数组而不修改原始数组的方法。

---

`push()`

### --feedback--

考虑一个创建新数组而不修改原始数组的方法。

---

`pop()`

### --feedback--

考虑一个创建新数组而不修改原始数组的方法。

---

`filter()`

## --video-solution--

4
