---
id: 5895f70df9fc0f352b528e69
title: Cómo utilizar las estrategias de Passport
challengeType: 2
forumTopicId: 301555
dashedName: how-to-use-passport-strategies
---

# --description--

En el archivo `index.pug` proporcionado, hay un formulario de inicio de sesion. Esta oculto debido al JavaScript en línea `if showLogin` con el formulatio indentado luego de este.

En el `res.render` para esa página, agrega una nueva variable para el objeto `showLogin: true`. Cuando actualices la página, ¡deberías ver el formulario! Este formulario est configurado para **POST** en `/login`. Así que, aquí es donde tu Debes configurar para aceptar la petición POST y autenticar al usuario.

Para este desafío, tu debes agregar la ruta `/login` para aceptar una petición POST. Para autentificarse en esta ruta, es necesario añadir un middleware para hacerlo antes de enviar una respuesta. Esto se hace pasando otro argumento con el middleware antes que tu respuesta. El middleware a usar es `passport.authenticate('local')`.

`passport.authenticate` puede además tomar algunas opciones como argumento tales como `{ failureRedirect: '/' }` la cual es increiblemente útil, así que asegurate de agregarla también. Agrega una respuesta luego de usar el middleware (la cual solo sera llamada si pasa la autenticación del middleware) esta redirige al usuario a `/profile`. Agrega también esa ruta, y haz que renderice la vista `profile.pug`.

Si la autentificación fue exitosa, el user object se guardará en `req.user`.

En este punto, si introduces un nombre de usuario y una contraseña en el formulario, debe redirigirse a la página de inicio `/`, y la consola de tu servidor debe mostrar `'User {USERNAME} attempted to log in.'`, ya que actualmente no podemos iniciar la sesión de un usuario que no está registrado.

Envía tu página cuando creas que está correcta. Si tienes errores, puedes <a href="https://forum.freecodecamp.org/t/advanced-node-and-express/567135#how-to-use-passport-strategies-7" target="_blank" rel="noopener noreferrer nofollow">consultar el proyecto completado hasta este punto</a>.

# --hints--

Todos los pasos deben ser correctamente implementados en `server.js`.

```js
  const url = new URL("/_api/server.js", code);
  const res = await fetch(url);
  const data = await res.text();
  assert.match(
    data,
    /showLogin:( |)true/,
    'You should be passing the variable "showLogin" as true to your render function for the homepage'
  );
  assert.match(
    data,
    /failureRedirect:( |)('|")\/('|")/,
    'Your code should include a failureRedirect to the "/" route'
  );
  assert.match(
    data,
    /login[^]*post[^]*local/,
    'You should have a route for login which accepts a POST and passport.authenticates local'
  );
```

Una solicitud POST `/login` debería redirigir correctamente a `/`.

```js
  const url = new URL("/login", code);
  const res = await fetch(url, { method: 'POST' });
  const data = await res.text();
  assert.match(
    data,
    /Looks like this page is being rendered from Pug into HTML!/,
    'A login attempt at this point should redirect to the homepage since we do not have any registered users'
  );
```

