---
id: 6733aae9d25004f60d1e86f2
title: 使用 JavaScript 驗證表單的幾種方法是什麼？
challengeType: 19
dashedName: what-are-some-ways-to-validate-forms-using-javascript
---

# --interactive--

在之前的課程中，你已經學會如何使用 HTML 限制使用者在你的表單中可以提交的值。但有時候這還不夠。如果你想要更複雜的功能，例如向使用者顯示你自己的錯誤訊息，你將需要使用 JavaScript。

某些 HTML 元素，例如 `textarea` 和 `input` 元素，會暴露出條件驗證 API。此 API 允許你斷言使用者為該元素提供的值通過你所撰寫的任何 HTML 層級驗證，例如最小長度或樣式匹配。

但是你實際上要如何使用它？假設你想讓公司員工透過像這樣的表單傳送回授訊息：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required type="email" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

:::

我們使用帶有內建驗證的電子郵件 `input`，用以檢查基本驗證，例如輸入是否包含 at (`@`) 符號。

但是如果使用者提供像 `example@email.com` 這樣的電子郵件位址呢？這會通過基本驗證，但我們想要更具體地接受來自公司電子郵件位址的郵件。

這裡我們可以使用 `pattern` 屬性來指定電子郵件位址必須以公司電子郵件位址結尾。以下是更新後的範例：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

:::

現在，如果你嘗試提交回授，你會看到一則訊息顯示「請符合要求的格式」。

即使 `input` 確實有顯示佔位文字來告訴他們所需的格式，使用 JavaScript 也最好同時包含訂製的錯誤訊息。

讓我們先來看看 `checkValidity()` 方法：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  console.log(e.target.checkValidity())
})
```

:::

在上述範例中，我們已從 DOM 查詢我們的輸入，並添加了一個 input 事件監聽器。

我們知道 `e.target` 是取用觸發該事件的元素。在這個案例中，是我們的 `input`。但什麼是 `checkValidity()` 方法？

這是 Constraint Validation API 的一部分。當元素符合所有基於其屬性的 HTML 驗證時，`checkValidity()` 方法會傳回 `true`，若驗證失敗則傳回 `false`。

當我們使用無效輸入嘗試時，我們會看到 `false` 被記錄在主控台。既然我們知道輸入是無效的，讓我們回報該無效性：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  if (!e.target.checkValidity()) {
    e.target.reportValidity();
  }
})
```

:::

因此，你會看到瀏覽器的錯誤訊息「Please match the requested format。」

它會立即回報無效狀態，而不是等待我們提交表單。但它仍然使用預設訊息。這是因為 `reportValidity` 方法只告訴瀏覽器輸入是無效的。瀏覽器仍然選擇如何顯示為何無效。這就是 `setCustomValidity` 方法的用武之地。

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  if (!e.target.checkValidity()) {
    e.target.setCustomValidity(
      "You must use a company email address that ends in @sampleCompany.com"
    );
  }
});
```

:::

此方法接受訂製錯誤訊息，該訊息會顯示給使用者。因此，你將會看到訂製錯誤訊息 `You must use a company email address that ends in @sampleCompany.com`。

如果你有興趣進一步探索不同型別的有效性狀態以及為什麼特定的驗證失敗，你可以像這樣記錄 `validity` 屬性：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  console.log(e.target.validity);
})
```

:::

`validity` 屬性是 `ValidityState` 物件的實體。以下是在瀏覽器中該物件可能的範例：

```js
ValidityState {
  badInput: false,
  customError: false,
  patternMismatch: true,
  rangeOverflow: false,
  rangeUnderflow: false,
  stepMismatch: false,
  tooLong: false,
  tooShort: false,
  typeMismatch: true,
  valueMissing: false,
  valid: true
}
```

有幾個有用的屬性，其值皆為布林值 `true` 或 `false`。

你可以自行進一步探索的一些有用屬性包括 `valueMissing` 屬性，當必填輸入欄位為空時其值為 `true`。或者 `patternMismatch`，如果值不符合指定的正則表達式樣式，其值為 `true`。

在本課程結束後，我鼓勵你嘗試操作本課程中提供的範例，並進一步探索不同的有效性屬性。

# --questions--

## --text--

Constraint Validation API 的哪個方法用於檢查輸入元素是否符合其所有驗證條件？

## --answers--

`validateInput()`

### --feedback--

本課程示範在為輸入元素添加事件監聽器時使用此方法。

---

`checkValidity()`

---

`isValid()`

### --feedback--

本課程示範在為輸入元素添加事件監聽器時使用此方法。

---

`testConstraints()`

### --feedback--

本課程示範在為輸入元素添加事件監聽器時使用此方法。

## --video-solution--

2

## --text--

`setCustomValidity()` 方法在表單驗證中的目的為何？

## --answers--

為無效輸入設定訂製的 CSS 樣式。

### --feedback--

本課程說明如何使用此方法來提供更具資訊性的回授給使用者。

---

為你的訂製驗證規則創建。

### --feedback--

本課程說明如何使用此方法來提供更具資訊性的回授給使用者。

---

要顯示無效輸入的訂製錯誤訊息。

---

改寫預設的 HTML 驗證。

### --feedback--

本課程說明如何使用此方法來提供更具資訊性的回授給使用者。

## --video-solution--

3

## --text--

當必填輸入欄位留空時，`validity` 物件的哪個屬性會變成 true？

## --answers--

`isEmpty`

### --feedback--

當記錄空的必填欄位的 `validity` 物件時，課程會顯示此屬性。

---

`required`

### --feedback--

當記錄空的必填欄位的 `validity` 物件時，課程會顯示此屬性。

---

`valueMissing`

---

`invalidValue`

### --feedback--

當記錄空的必填欄位的 `validity` 物件時，課程會顯示此屬性。

## --video-solution--

3
