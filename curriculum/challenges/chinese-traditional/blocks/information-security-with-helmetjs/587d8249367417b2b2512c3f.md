---
id: 587d8249367417b2b2512c3f
title: 使用 helmet.contentSecurityPolicy() 設定內容安全政策
challengeType: 2
forumTopicId: 301585
dashedName: set-a-content-security-policy-with-helmet-contentsecuritypolicy
---

# --description--

提醒你，這個專案是基於從 <a href="https://github.com/freeCodeCamp/boilerplate-infosec/" target="_blank" rel="noopener noreferrer nofollow">GitHub</a> 複製的以下起始專案所建立。

這個挑戰凸顯了一種有前景的新防禦機制，可以大幅降低現代瀏覽器中多種攻擊的風險和影響。透過設定和組態 Content Security Policy，你可以防止任何非預期的內容注入你的頁面。這將保護你的應用程式免受 XSS 漏洞、不當追蹤、惡意影格等威脅。CSP 的運作方式是定義一個被信任的內容來源允許列表。你可以為網頁可能需要的每種資源（腳本、樣式表、字型、影格、媒體等等）組態這些來源。提供多種指令，因此網站擁有者可以進行細緻的控制。詳情請參考 HTML 5 Rocks、KeyCDN。不幸的是，舊版瀏覽器不支援 CSP。

預設指令是完全開放的，因此設定 `defaultSrc` 指令作為後備非常重要。Helmet 同時支援 `defaultSrc` 和 `default-src` 命名風格。後備適用於大多數未指定的指令。

# --instructions--

在這個練習中，使用 `helmet.contentSecurityPolicy()`。透過添加一個 `directives` 物件來組態它。在該物件中，將 `defaultSrc` 設定為 `["'self'"]`（允許的來源列表必須在陣列中），以便預設只信任你的網站位址。也設定 `scriptSrc` 指令，使你只允許從你的網站（`'self'`）和網域 `'trusted-cdn.com'` 下載腳本。

提示：在 `'self'` 關鍵字中，單引號是關鍵字本身的一部分，因此需要用雙引號括起來才能生效。

# --hints--

應正確掛載 helmet.contentSecurityPolicy() 中介層

```js
const response = await fetch(code + '/_api/app-info');
if (!response.ok) {
  throw Error(await response.text());
}
const data = await response.json();
assert.include(data.appStack, 'csp');
```

你的 csp 設定不正確。defaultSrc 應該是 ["'self'"]，而 scriptSrc 應該是 ["'self'"、'trusted-cdn.com']。

```js
const response = await fetch(code + '/_api/app-info');
if (!response.ok) {
  throw Error(await response.text());
}
const data = await response.json();
var cspHeader = Object.keys(data.headers).filter(function (k) {
  return (
    k === 'content-security-policy' ||
    k === 'x-webkit-csp' ||
    k === 'x-content-security-policy'
  );
})[0];
assert.equal(
  data.headers[cspHeader],
  "default-src 'self'; script-src 'self' trusted-cdn.com"
);
```
