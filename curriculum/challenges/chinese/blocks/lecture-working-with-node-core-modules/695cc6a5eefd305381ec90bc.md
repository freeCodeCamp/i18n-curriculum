---
id: 695cc6a5eefd305381ec90bc
title: 什么是 `fs` 模块及其工作原理？
challengeType: 19
dashedName: what-is-the-fs-module-and-how-does-it-work
---

# --description--

许多语言和框架都提供了处理文件和文件夹的方法。Node.js 允许你使用 `fs` 或文件系统模块来完成此操作。

本课将重点介绍 Node 的 `fs` 模块、它的工作原理以及你可以使用它提供的方法的三种不同方式。

Node 的 `fs` 模块为你提供了用于操作文件和文件夹的各种方法，包括打开和关闭、读取和写入以及删除操作。

`fs` 模块是 Node.js 的标准模块，只要你的环境中安装了 Node.js，就可以使用该模块。要使用该模块，你可以这样导入：

```js
const fs = require("fs");
```

`fs` 模块提供的灵活性在于它允许你以同步的和异步的形式使用其方法。`fs` 模块的方法默认是异步的，但对于每个方法，都有一个同步的形式：

```js
fs.writeFile() // Asynchronous file writing
fs.writeFileSync() // Synchronous file writing

fs.readFile() // Asynchronous file reading
fs.readFileSync() // Synchronous file reading

fs.open() // Opens a file
fs.openAsBlob() // Opens as blob
fs.openSync() // Synchronous open
fs.opendir() // Opens directory
fs.opendirSync() // Synchronous directory open
```

这还不是结束。根据你的需求，你可以用三种方式使用这些方法：

- 使用回调，例如 `fs.writeFile()`（异步的）
- 如果你更喜欢 `async/await` 语法，例如 `fs.promises.writeFile()`，可以使用 promises。
- 同步地，例如，`fs.writeFileSync()`

以下是这些方法异步使用的基本语法：

```js
fs.writeFile("filePath", "content", "utf8", (err) => {
  if (err) {
    throw err;
  }
  console.log("File written to!");
});
```

对于 promises 版本，你可以从 `fs/promises` 导入，或者将 `promises` 链接到你的 `fs` 导入。语法如下：

```js
async function promisesExample() {
  try {
    await fs.promises.writeFile("filePath", "content", "utf8");
    console.log("File written to!");
  } catch (err) {
    console.error("Error:", err);
  }
}

promisesExample();
```

下面是同步的版本：

```js
try {
  fs.writeFileSync("filePath", "content", "utf8");
  console.log("File written to!");
} catch (err) {
  console.error("Error:", err);
}
```

请注意，使用任何方法的同步操作都是阻塞的。换句话说，你的程序将在继续执行下一行代码之前停止运行并等待操作完成。

对于快速脚本、小型项目或一次性任务，同步的方法可能没问题。但在实际应用中，阻塞的 I/O（输入/输出）会成为问题，因为当 Node 等待文件系统完成其操作时，它可能会冻结应用的其他部分。这会导致速度变慢，影响性能和用户体验。

这就是异步的方法存在的原因。它们允许你的程序其余部分继续运行，同时 Node 在后台处理文件操作。传统上，这使用回调，但随着你的应用程序增长，回调可能很快变得混乱。

Promises 和 `async/await` 解决了这个问题。它们仍然是非阻塞的，但代码读起来像普通的同步代码，更容易维护。 

因此，基于 promises 的方法如今通常更受欢迎，这也是我们在本课剩余部分将使用的方法。

`writeFile()` 方法允许你写入一个已存在的文件。如果文件不存在，它会在当前目录中创建该文件，然后写入指定的内容。

以下是如何使用 `writeFile()` 方法：

```js
const fs = require("fs/promises");

async function writeToFile() {
  try {
    await fs.writeFile(
      "article.md",
      "## Node `fs` Module: The Complete Guide",
      "utf8",
    );
    console.log("File written to!");
  } catch (err) {
    console.error("Error writing to file:", err);
  }
}

writeToFile(); // File written to!
```

这是 article.md `file` 之后的内容：

```md
## Node `fs` Module: The Complete Guide
```

`appendFile()` 方法允许你为现有文件的内容添加内容。以下是使用方法：

```js
const fs = require("fs/promises");

async function appendToFile() {
  try {
    await fs.appendFile(
      "article.md",
      "\nIn this article, you will learn all there is to know about the Node fs module...",
      "utf8",
    );
    console.log("File appended to!");
  } catch (err) {
    console.log("Error appending to file:", err);
  }
}

appendToFile(); // File appended to!
```

`readFile()` 方法让你查看一个文件的内容：

```js
const fs = require("fs/promises");

async function readFileContent() {
  try {
    const fileContent = await fs.readFile("article.md", "utf8");
    console.log("File content:", fileContent);
  } catch (err) {
    console.log("File read successfully");
  }
}

readFileContent();

/*
File content: ## Node `fs` Module: The Complete Guide

In this article, you will learn all there is to know about the Node fs module...
*/
```

如果你不指定 `utf8` 字符编码，你将获得作为缓冲区的文件内容：

```js
async function readFileContent() {
  try {
    const fileContent = await fs.readFile("article.md");
    console.log("File content:", fileContent);
  } catch (err) {
    console.log("File read successfully");
  }
}

readFileContent();

/*
File content: <Buffer 23 23 20 4e 6f 64 65 20 60 66 73 60 20 4c 69 62 72 61 72 79 3a 20
 54 68 65 20 43 6f 6d 70 6c 65 74 65 20 47 75 69 64 65 0a 0a 49 6e 20 74 68 69 73 20 ... 
72 more bytes>
*/
```

在下一课中，你将学习如何使用 Node.js Buffer 模块处理这样的缓冲区。

最后，`unlink()` 方法允许你删除一个文件：

```js
const fs = require("fs/promises");

async function deleteFile() {
  try {
    await fs.unlink("article.ts");
    console.log("File deleted successfully!");
  } catch (err) {
    console.error("Error deleting file:", err);
  }
}

deleteFile();
```

如果文件不存在，你会收到类似这样的错误信息：

```bash
Error deleting file: Error: ENOENT: no such file or directory, unlink 'article.ts'
```

如果存在，该文件将被删除，并且你会收到你设置的成功消息。

# --questions--

## --text--

Node `fs` 模块的主要用途是什么？

## --answers--

在浏览器中创建动态 `HTML` 页面。

### --feedback--

考虑如何直接从 Node.js 处理像文本文档或文件夹这样的文件。

---

将 Node.js 连接到数据库。

### --feedback--

考虑如何直接从 Node.js 处理像文本文档或文件夹这样的文件。

---

与文件系统交互以进行文件和文件夹的 CRUD 操作。

---

管理 Node.js 包安装。

### --feedback--

考虑如何直接从 Node.js 处理像文本文档或文件夹这样的文件。

## --video-solution--

3

## --text--

Node `fs` 模块中哪个 `method` 允许你将内容写入 `file`，如果该 `file` 不存在则创建它？

## --answers--

`writeFile()`

---

`readFile()`

### --feedback--

考虑既 `创建` 又写入内容到 `file` 的 `method`。

---

`appendFile()`

### --feedback--

考虑既 `创建` 又写入内容到 `file` 的 `method`。

---

`unlink()`

### --feedback--

考虑既 `创建` 又写入内容到 `file` 的 `method`。

## --video-solution--

1

## --text--

以下哪项**不是**你可以在 Node 的 `fs` 模块中使用方法的三种方式之一？

## --answers--

例如，使用回调的 `fs.writeFile()`。

### --feedback--

两个是异步的，一个是同步的，一个不存在。

---

 例如，使用 `fs.promises.writeFile()`。

### --feedback--

两个是异步的，一个是同步的，一个不存在。

---

同步的，例如 `fs.writeFileSync()`。

### --feedback--

两个是异步的，一个是同步的，一个不存在。

---

例如，使用 JSON 解析时，`fs.parseFile()`。

## --video-solution--

4

