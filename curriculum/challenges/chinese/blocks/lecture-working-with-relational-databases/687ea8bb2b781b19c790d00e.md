---
id: 687ea8bb2b781b19c790d00e
title: SQL 中的主密钥和外键是什么，它们如何工作？
challengeType: 19
dashedName: what-are-primary-and-foreign-keys-in-sql-and-how-do-they-work
---

# --description--

在 SQL 中，主键和外键用于建立表格之间的关系。

让我们从主密钥开始。

主键是唯一标识表格中每条记录（行）的单个列或列集合。该约束确保表格中没有记录具有相同的主键值。

这就是为什么一个表格只能有一个主密钥。

主键列中的值也不能是 `NULL`，因此它们将始终具有有效值。

在 PostgreSQL 中，要将某列设为你的表格的主键，只需在数据类型后添加 `PRIMARY KEY`：

```sql
column_name data_type PRIMARY KEY
```

这是一个 `students` 表格的示例：

```sql
CREATE TABLE students (
  student_id SERIAL PRIMARY KEY,
  name VARCHAR(100)
);
```

每个学生都会有自己的 `student_id`，该 ID 将是表格的主密钥。这里 `SERIAL` 类型很有用，因为它确保 `student_id` 始终具有唯一值。

复合主键用于当一个表格没有单一唯一列来标识行时。在这种情况下，你可以使用两个或多个列的组合作为主键，这些列组合在一起是唯一的。

为此，在你创建表格时，标明哪些列是复合主键，如下所示：

```sql
CREATE TABLE table_name (
  column1 data_type column_constraint,
  column2 data_type column_constraint,
  column3 data_type column_constraint,
  ...
  PRIMARY KEY (column1, column2)
);
```

假设你有一个包含 `student_id` 和 `course_id` 列的表格，它告诉你哪些学生选修了各种类。

每个学生将被注册到多个类中，每个类中也会有多个学生注册。因此两个列都不是唯一的——但你永远不会有同一个学生在同一个类中注册超过一次。所以你可以使用这两个列的组合作为主密钥：

```sql
CREATE TABLE course_enrollments (
  student_id INT,
  course_id INT,
  ...
  PRIMARY KEY (student_id, course_id),
);
```

主键对于确保数据唯一性和完整性、优化数据检索以及在关系数据库中与其他表格建立关系至关重要。

这将引出本课中我们将介绍的下一种密钥类型：外键。

外键是表格中引用另一个表格主键的列（或列集合）。一个表格可以有多个外键。

在此示例中，我们有两个表格，`customers` 和 `orders`：

```sql
CREATE TABLE customers (
  customer_id SERIAL PRIMARY KEY,
  first_name VARCHAR(100) NOT NULL,
  ...
);

CREATE TABLE orders (
  order_id SERIAL PRIMARY KEY,
  customer_id INTEGER,
  ...
  FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
);
```

`customers` 表格的主键是 `customer_id`，`orders` 表格的主键是 `order_id`。

但请注意，`orders` 表格中也有一个 `customer_id` 列。

为什么我们要将客户信息存储在 `orders` 表格中？

我们这样做是为了创建 `customers` 和 `orders` 表格之间的关系。每个订单都会保存提交该订单的客户的 ID。

要创建表格之间的关系，我们将使 `orders` 表格中的 `customer_id` 列成为引用 `customers` 表格中 `customer_id` 列的外键：

```sql
FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
```

外键列中的值必须与被引用表中的主键值匹配，或者为 `NULL`（如果外键允许 `NULL`）。

这为什么有帮助？

通过确保这两个表格中的这些列完全匹配，外键和主键防止创建“孤立”记录，即引用另一个表格中不存在的记录的记录。

主键和外键是关系数据库的基础。它们驱动这些数据库的“关系”特性，使你能够以准确的方式建模现实世界的数据。

# --questions--

## --text--

关系数据库表格中 `primary key` 的主要用途是什么？

## --answers--

将表格链接到其他表格。

### --feedback--

考虑是什么使表格中的每一行具有独特性。

---

用于唯一标识表格中的每条记录。

---

定义列的数据类型。

### --feedback--

考虑是什么使表格中的每一行具有独特性。

---

迫使同一表格中的外键关系。

### --feedback--

考虑是什么使表格中的每一行具有独特性。

## --video-solution--

2

## --text--

一个表格中的外键通常引用另一个表格中的哪个密钥？

## --answers--

另一个外键

### --feedback--

考虑被引用表格中哪个密钥确保由外键创建的关系的完整性和有效性。

---

唯一索引

### --feedback--

考虑被引用表格中哪个密钥确保由外键创建的关系的完整性和有效性。

---

主密钥

---

任何具有相同数据类型的列

### --feedback--

考虑被引用表格中哪个密钥确保由外键创建的关系的完整性和有效性。

## --video-solution--

3

## --text--

以下哪项是主键的特征？

## --answers--

它可以包含 NULL 值。

### --feedback--

记住明确识别每一行的基本要求。

---

它可以在同一个表格中重复。

### --feedback--

记住明确识别每一行的基本要求。

---

一个表格可以有多个主密钥。

### --feedback--

记住明确识别每一行的基本要求。

---

它必须包含唯一值。

## --video-solution--

4
