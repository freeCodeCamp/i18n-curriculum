---
id: 6724e18296fa40173cc2437c
title: 网页性能评审
challengeType: 31
dashedName: review-web-performance
---

# --description--

## 真实性能与感知性能之间的差异

- **感知性能**：这是用户对网站性能的感知。它是用户根据响应速度和可靠性对网站进行的评估。这是一种主观的衡量标准，因此很难量化，但非常重要，因为用户体验决定了网站的成败。
- **真实性能**：这是网站的客观且可测量的性能。它通过页面装载时间、服务器响应时间和渲染时间等指标来衡量。这些测量受多个与网络和代码本身相关的因素影响。

## 提升感知性能的技术

- **惰性装载**：这种技术通过在后台装载非必要资源，尽可能减少初始装载时间。
- **最小化字体延迟**：如果你的网站有自定义字体，你也应该尽量最小化字体装载延迟，因为这可能导致闪烁或在自定义字体装载时显示备用字体。一个建议是使用与自定义字体相似的备用字体，这样如果发生这种情况，变化会更为细微。
- **加载指示器的使用**：当用户点击一个元素后立即显示长时间运行进程的加载指示器，可以帮助用户感受到与进程的连接和参与，使等待时间感觉更短。

## 核心性能概念

- **源顺序**：这指的是 HTML 元素在文档中的结构方式。这决定了什么先装载，并且会显著影响性能和无障碍。

源顺序的一些最佳实践包括：

- 将关键内容（例如标题、导航或主要文本）放置在 `HTML` 结构的更高位置。
- 推迟非必要的脚本，例如用于分析的脚本或第三方小部件，以免它们阻塞渲染。
- 使用渐进增强，确保核心体验即使在样式和脚本装载之前也能正常工作。渐进增强是一种基于先使页面使用超文本标记语言正常工作的理念来创建网站和应用的方法。

这是一个良好源顺序的示例，使用了我们刚刚讲解的最佳实践：

```html
<h1>Welcome to FastSite!</h1>
<p>Critical information loads first.</p>
<script src="slow-script.js" defer></script>
```

- **关键渲染路径**：这是浏览器将代码转换为屏幕上像素所遵循的序列步骤。
- **延迟**：这是一个 `request` 在浏览器和 `server` 之间传输所需的时间。换句话说，延迟高意味着页面加载缓慢。

减少延迟的一些方法包括：

- 使用 CDN，或内容分发网络，从更近的位置提供文件。
- 使用诸如 Gzip 等工具启用压缩以减小文件大小。
- 优化图像并使用惰性装载。

```html
<img src="placeholder.jpg" data-src="real-image.jpg" loading="lazy">
```

## 提升 INP

- **定义**：INP（Interaction to Next Paint）通过测量用户交互（如点击或按键）到浏览器下一次更新显示之间的时间，评估页面的整体响应性。INP 越低表示页面响应越快。

以下是一些提升 INP 的方法：

- 通过拆分长时间的 JavaScript 任务来减少主线程工作量。
- 为非关键脚本使用 `requestIdleCallback()`。这将把一个函数添加到浏览器闲置期间调用的队列中。
- 推迟或惰性装载之前提到的重资产。
- 优化事件处理器。如果这些处理器运行过于频繁或执行繁重的操作，会导致页面变慢并增加 INP。解决方案是防抖。防抖确保函数仅在用户停止输入后经过短暂延迟（例如 300 毫秒）才运行。这可以防止不必要的计算并提升性能。

## 浏览器中渲染的工作原理

- **渲染的工作原理**：首先，浏览器解析 `HTML` 并构建 `DOM`。接着，浏览器处理 `CSS`，构造 `CSS Object Model`，或称 `CSSOM`。这是另一个树结构，用于决定元素应如何被样式化。最后，浏览器将像素绘制到屏幕上，根据计算出的样式和版型渲染每个元素。在复杂页面中，这可能涉及多个图层的合成，以形成最终的视觉输出。

## 性能如何影响可持续性

- **背景简介**：互联网约占全球碳排放的 2％——这与航空业相同！每个传输的字节都需要电力，从数据中心到用户设备。更大的文件和低效的脚本意味着更多的能耗。高性能的网站不仅更快，还能减少不必要的处理和能源使用。

## 减少页面装载时间的方法

- **优化媒体资源**：大型图像和视频是导致加载缓慢的常见原因。通过优化这些资源，你可以显著加快你的网站速度。这包括压缩图像、使用像 WebP 这样的现代形式以及为资源使用惰性装载。
- **杠杆浏览器缓存**：缓存允许浏览器将你网站的部分内容局部地保存，减少回访用户的装载时间。
- **压缩和压缩文件**：减小你的文件大小可以加快下载速度。这包括减小传输文件的大小以及压缩 CSS 和 JavaScript 文件。

## 提升 `"time to usable"`

- **定义**：“time to usable” 是指用户请求页面到他们能够有意义地与之交互之间的时间间隔。为了改善 “time to usable”，你可以惰性装载你的资源或最小化阻塞渲染的资源。

## 用于衡量性能的关键指标

- **首次内容绘制或 FCP**：它衡量第一个内容——文本或图像——在屏幕上出现的速度。良好的 FCP 被认为是在 1.8 秒以下，较差的 FCP 则超过 3 秒。你可以使用 Chrome DevTools 并查看性能标签（页）来查看你的 FCP。
- **总阻塞时间**：这显示主线程被繁重的 JavaScript 任务阻塞了多长时间。如果总阻塞时间（TBT）较高，用户会感受到交互迟缓。为改善 TBT，请拆分长任务并推迟非必要的脚本。
- **弹跳率**：这是指访问者在没有任何互动的情况下离开的百分比。如果你的网站弹跳率很高，可能是因为你的页面太慢。
- **独立用户**：此指标跟踪访问你网站的独立访客数量。要查看 `Bounce Rate` 和 `Unique Users`，你可以使用 Google Analytics。它将允许你监控这些指标并提升参与度。

## 常用性能测量工具

- **Chrome DevTools**：Chrome DevTools 是 Google Chrome 内置的工具，允许你实时分析和调试性能。DevTools 会显示装载时间、CPU 使用率和渲染延迟。它对于测量首次内容绘制（First Contentful Paint，简称 FCP）特别有用，FCP 是用户看到第一个可见内容的速度。如果你的网站感觉缓慢，DevTools 会帮助你发现瓶颈。
- **Lighthouse**：这是一个自动化工具，用于查看性能、SEO 和无障碍。
- **WebPageTest**：该工具允许你测试你的网站从不同地点和设备的装载情况。该工具为你提供你的网站的 Speed Index、Total Blocking Time 及其他关键性能指标的详细分解。如果你想了解真实用户在全球范围内如何体验你的网站，WebPageTest 是适合你的工具。
- **PageSpeed Insights**：该工具分析你的网站，并为移动和桌面提供快速改进建议。它会告诉你是什么拖慢了你的网站，并给出具体建议，如优化图像、移除阻塞渲染的脚本以及减少服务器响应时间。PageSpeed Insights 是查看 Google 如何看待你网站性能的快速简便方法。
- **真实用户监控**：RUM 工具跟踪实际用户行为，展示真实访客如何体验你的网站。流行的 RUM 工具包括 Google Analytics，它跟踪页面装载时间和弹跳率，以及 New Relic 或 Datadog，它们监控实时性能问题。如果你想获得来自实际用户的数据，RUM 工具是必不可少的。

## 使用 Performance Web APIs

- **定义**：性能 Web API 让开发者能够直接在代码中跟踪网页装载和响应的高效性。这些 API 允许你测量页面装载时间、跟踪渲染和交互延迟以及分析 JavaScript 执行时间。
- **`performance.now()`**：此 API 为你提供高查准率的时间戳（以毫秒为单位），用于测量你网站不同部分的装载时间。

```js
const start = performance.now();  
// Run some code here  
const end = performance.now();  

console.log(`Execution time: ${end - start}ms`);
```

- **性能 Timing API**：此 API 为你提供页面装载每个阶段的详细信息，从 DNS 查询到 `DOMContentLoaded`。

```js
const timing = performance.timing;  

const pageLoadTime = timing.loadEventEnd - timing.navigationStart;  
console.log(`Page load time: ${pageLoadTime}ms`);
```

- **`PerformanceObserver`**：此 API 监听诸如版型移动、长任务和用户交互等性能事件。

```js
const observer = new PerformanceObserver((list) => {  
  list.getEntries().forEach((entry) => {  
    console.log(`Long task detected: ${entry.duration}ms`);  
  });  
});  

observer.observe({ type: "longtask", buffered: true });
```

## 提升 CSS 性能的技术

- **CSS 动画**：对某些 CSS 属性（例如维度、位置和版型）进行动画处理会触发一个称为“reflow”的进程，在此过程中浏览器会重新计算页面上某些元素的位置和几何形状。这需要重绘，计算开销很大。因此，建议尽可能减少 CSS 动画的数量，或者至少为用户提供一个选项来切换它们的开关。

## 提升 JavaScript 性能的技术

- **代码拆分**：将你的 JavaScript 代码拆分成执行关键任务和非关键任务的模块也很有帮助。这样，你就能尽快预装载关键模块，并推迟非关键模块，以尽可能快地渲染页面。
- **DOM 操作**：请记住，DOM 操作是指通过与文档对象模型（DOM）交互，使用 JavaScript 动态更改页面内容的过程。操作 DOM 的计算开销很大。通过减少你的 JavaScript 代码中的 DOM 操作量，将提升性能。

# --assignment--

查看 Web 性能 主题和 概念。
