---
id: 695b93cb572125a6fb19f39e
title: 什么是 `package-lock.json` 文件？
challengeType: 19
dashedName: what-is-the-package-lock-json-file
---

# --description--

当你使用 npm 安装依赖时，尤其是在现有项目中，npm 会查看你的 `package.json` 文件以确定你的项目需要哪些包。

`package.json` 中的每个依赖都包含如下的版本号：

```bash
"lodash": "^4.17.21"
```

正如你之前学到的，**插入符号 (^)** 允许 npm 安装较新的次要版本和补丁版本，例如 `4.18.0` 或 `4.17.22`。这种灵活性很有帮助，但也可能导致问题。

如果两个开发者在不同时间运行 `npm install`，npm 可能会安装同一包的略微不同版本。即使是细微的差异也可能导致错误或意外行为。

`package-lock.json` 文件解决了这个问题。它会在你第一次运行 `npm install` 时自动创建，并且锁定安装的每个依赖的确切版本——包括所有子依赖，即依赖的依赖。

这保证了每个参与该项目的人每次都能获得相同版本的包。

这是一个简单的 `package.json` 文件，其中包含 `lodash` 作为依赖：

```bash
{
  "name": "package-lock-json",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "dependencies": {
    "lodash": "^4.17.21"
  }
}
```

下面是来自 `package-lock.json` 的匹配部分：

```bash
"node_modules/lodash": {
  "version": "4.17.21",
  "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz",
  "integrity": "sha512-v2kDEe57..."
}
```

注意区别：

* 在 `package.json` 中，`lodash` 被列为 `^4.17.21` —— 一个灵活的规则。
    
* 在 `package-lock.json` 中，`lodash` 被锁定到版本 `4.17.21`。
    

无论何时有人运行 `npm install`，他们都会获得那个确切的版本。

这样，无论何时有人运行 `npm install`，他们每次都会获得完全相同版本的 Lodash。

请注意，这也适用于子依赖项，即你为你的项目使用的任何依赖项的依赖项。

例如，以下是使用 Express 的 `package-lock.json` 文件的一部分：

```json
{
  "name": "package-lock-json-file",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "package-lock-json-file",
      "version": "1.0.0",
      "license": "ISC",
      "dependencies": {
        "express": "^5.2.1"
      }
    },
    ...
    "node_modules/etag": {
      "version": "1.8.1",
      "resolved": "https://registry.npmjs.org/etag/-/etag-1.8.1.tgz",
      "integrity": "sha512-aIL5Fx7mawVa300al2BnEE4iNvo1qETxLrPI/o05L7z6go7fCw1J6EQmbK4FmJ2AS7kgVF/KEZWufBfdClMcPg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/express": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/express/-/express-5.2.1.tgz",
      "integrity": "sha512-hIS4idWWai69NezIdRt2xFVofaF4j+6INOpJlVOLDO8zXGpUVEVzIYk12UUi2JzjEzWL3IOAxcTubgz9Po0yXw==",
      "license": "MIT",
      "dependencies": {
        "accepts": "^2.0.0",
        "body-parser": "^2.2.1",
        "content-disposition": "^1.0.0",
        "content-type": "^1.0.5",
        "cookie": "^0.7.1",
        "cookie-signature": "^1.2.1",
        "debug": "^4.4.0",
        "depd": "^2.0.0",
        "encodeurl": "^2.0.0",
        "escape-html": "^1.0.3",
        "etag": "^1.8.1",
        "finalhandler": "^2.1.0",
        "fresh": "^2.0.0",
        "http-errors": "^2.0.0",
        "merge-descriptors": "^2.0.0",
        "mime-types": "^3.0.0",
        "on-finished": "^2.4.1",
        "once": "^1.4.0",
        "parseurl": "^1.3.3",
        "proxy-addr": "^2.0.7",
        "qs": "^6.14.0",
        "range-parser": "^1.2.1",
        "router": "^2.2.0",
        "send": "^1.1.0",
        "serve-static": "^2.2.0",
        "statuses": "^2.0.1",
        "type-is": "^2.0.1",
        "vary": "^1.1.2"
      },
      "engines": {
        "node": ">= 18"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    ...others
  }
}
```

你可以看到，除了 Express 本身，还有其他包如 `accepts`、`mime-types` 和 `negotiator`。这些是子依赖，是 Express 内部工作所依赖的包。

还要注意，虽然 `node_modules/express` 中的 `dependencies` 确实使用了插入符号表示范围，但如果你查找每个子依赖项的条目，比如 `node_modules/etags`，它们都是固定到特定版本的。

简而言之，`package-lock.json` 文件让所有人保持一致，并确保开发者机器、CI 服务器、部署和其他环境之间的一致性。

始终使用 Git 提交你的 `package-lock.json` 文件非常重要，这样你的团队才能共享相同的设置。此外，不要手动编辑 `package-lock.json` 文件——每当依赖项发生变化时，npm 会自动更新它。

# --questions--

## --text--

`package-lock.json` 文件如何解决不同环境之间的版本不一致问题？

## --answers--

通过自动将所有依赖项更新到其最新版本。

### --feedback--

考虑它如何确保每个人安装相同的依赖版本。

---

通过在安装新依赖项之前删除旧依赖项。

### --feedback--

考虑它如何确保每个人安装相同的依赖版本。

---

通过冻结已安装依赖项的确切版本。

---

仅存储每个依赖的主版本号。

### --feedback--

考虑它如何确保每个人安装相同的依赖版本。

## --video-solution--

3

## --text--

为什么你应该始终将你的 `package-lock.json` 文件提交到 Git？

## --answers--

为了让你的机器上 `npm` 运行更快。

### --feedback--

考虑保持每个开发者的环境一致。

---

让你的团队共享相同的依赖版本和设置。

---

自动更新过时的依赖项。

### --feedback--

考虑保持每个开发者的环境一致。

---

为了减小你的 Git 仓库的大小。

### --feedback--

考虑保持每个开发者的环境一致。

## --video-solution--

2

## --text--

什么是子依赖？

## --answers--

已安装但在项目中从未使用的包。

### --feedback--

考虑你的主要依赖项本身所依赖的依赖项。

---

依赖于你项目主文件来运行的包。

### --feedback--

考虑你的主要依赖项本身所依赖的依赖项。

---

仅在开发期间使用的包。

### --feedback--

考虑你的主要依赖项本身所依赖的依赖项。

---

你的依赖项内部依赖以正常工作的包。

## --video-solution--

4
