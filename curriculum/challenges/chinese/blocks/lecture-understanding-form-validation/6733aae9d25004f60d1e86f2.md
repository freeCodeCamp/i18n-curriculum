---
id: 6733aae9d25004f60d1e86f2
title: 使用 JavaScript 验证形式的几种方法有哪些？
challengeType: 19
dashedName: what-are-some-ways-to-validate-forms-using-javascript
---

# --interactive--

在之前的课程中，你已经学习了如何使用超文本标记语言限制用户在你的表单中提交的值。但有时这还不够。如果你想变得更复杂，比如向用户显示你自己的错误信息，你将需要使用脚本。

某些超文本标记语言元素，例如 `textarea` 和 `input` 元素，暴露了一个约束验证 API。该 API 允许你断言用户为该元素提供的值通过你编写的任何超文本标记语言级别的验证，例如最小长度或模式匹配。

但是你实际上如何使用它？假设你想让公司员工通过这样的形式发送反馈消息：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required type="email" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

:::

我们使用带有内置验证的电子邮件 `input` 来查看基本验证，例如输入是否包含 at (`@`) 符号。

但是如果用户提供了像 `example@email.com` 这样的电子邮件地址怎么办？这将通过基本验证，但我们希望更具体地接受来自公司电子邮件地址的邮件。

这里我们可以使用 `pattern` 属性来指定电子邮件地址必须以公司电子邮件地址结尾。更新后的示例如下：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

:::

现在，如果你尝试提交反馈，你将看到一条消息显示 "Please match the requested format."

尽管 `input` 确实有占位符文本显示所需的形式，但最好也使用 JavaScript 添加自定义错误信息。

我们先查看 `checkValidity()` 方法：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  console.log(e.target.checkValidity())
})
```

:::

在上面的示例中，我们已从 DOM 查询了我们的输入，并添加了一个输入事件监听器。

我们知道 `e.target` 指的是触发该事件的元素。在这个例子中，是我们的 `input`。但是，什么是 `checkValidity()` 方法？

这是约束验证 API 的一部分。`checkValidity()` 方法在元素匹配所有基于其属性的超文本标记语言验证时返回 `true`，否则返回 `false`。

当我们尝试使用无效的 `input` 时，我们看到控制台中记录了 `false`。既然我们知道 `input` 是无效的，就让我们报告该无效性：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  if (!e.target.checkValidity()) {
    e.target.reportValidity();
  }
})
```

:::

因此，你将看到浏览器的错误信息 `"Please match the requested format."`。

它会立即报告无效状态，而不是等待我们提交表单。但它仍然使用默认消息。这是因为 `reportValidity` 方法只是告诉浏览器输入无效。浏览器仍然选择如何显示无效的原因。这就是 `setCustomValidity` 方法的作用所在。

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  if (!e.target.checkValidity()) {
    e.target.setCustomValidity(
      "You must use a company email address that ends in @sampleCompany.com"
    );
  }
});
```

:::

此方法接受一个自定义错误信息，该信息会显示给用户。因此，你将看到自定义错误信息 `You must use a company email address that ends in @sampleCompany.com`。

如果你想进一步了解不同类型的有效性状态以及某个特定验证失败的原因，你可以这样记录 `validity` 属性：

:::interactive_editor

```html
<link rel="stylesheet" href="styles.css" />
<form>
  <label>Enter your email: </label>
  <input required placeholder="username@sampleCompany.com" type="email" pattern=".+@sampleCompany\.com" />

  <label>Enter your feedback: </label>
  <textarea required placeholder="Your feedback here..."></textarea>

  <button type="submit">Submit Feedback</button>
</form>
<script src="index.js"></script>
```

```css
form {
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: Arial, sans-serif;
}

label {
  font-weight: 600;
  margin-bottom: 4px;
  color: #333;
}

input,
textarea {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input:focus,
textarea:focus {
  border-color: #0078d4;
  box-shadow: 0 0 3px rgba(0, 120, 212, 0.5);
  outline: none;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button[type="submit"] {
  background-color: #0078d4;
  color: #fff;
  border: none;
  padding: 10px 16px;
  font-size: 14px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

button[type="submit"]:hover {
  background-color: #005ea2;
}

```

```js
const input = document.querySelector("input");

input.addEventListener("input", (e) => {
  console.log(e.target.validity);
})
```

:::

`validity` 属性是 `ValidityState` 对象的一个实例。以下是该对象在浏览器中的示例：

```js
ValidityState {
  badInput: false,
  customError: false,
  patternMismatch: true,
  rangeOverflow: false,
  rangeUnderflow: false,
  stepMismatch: false,
  tooLong: false,
  tooShort: false,
  typeMismatch: true,
  valueMissing: false,
  valid: true
}
```

有几个有用的属性，其值都是布尔类型的 `true` 或 `false`。

你可以自行深入探索的一些有用属性包括 `valueMissing` 属性，当必填输入字段为空时该属性为 `true`。或者 `patternMismatch`，如果值不匹配指定的正则表达式模式，该属性为 `true`。

在本课之后，我鼓励你尝试本课中给出的示例，并进一步探索不同的有效性属性。

# --questions--

## --text--

Constraint Validation API 的哪个方法用于查看输入元素是否满足其所有验证约束？

## --answers--

`validateInput()`

### --feedback--

本课演示了在为 `input` 元素添加事件监听器时使用此方法。

---

`checkValidity()`

---

`isValid()`

### --feedback--

本课演示了在为 `input` 元素添加事件监听器时使用此方法。

---

`testConstraints()`

### --feedback--

本课演示了在为 `input` 元素添加事件监听器时使用此方法。

## --video-solution--

2

## --text--

`setCustomValidity()` 方法在表单验证中的作用是什么？

## --answers--

为无效 `input` 设置自定义 CSS 样式。

### --feedback--

本课解释了如何使用此方法为用户提供更有信息量的反馈。

---

创建自定义验证规则。

### --feedback--

本课解释了如何使用此方法为用户提供更有信息量的反馈。

---

显示无效输入的自定义错误信息。

---

要覆写默认的超文本标记语言验证。

### --feedback--

本课解释了如何使用此方法为用户提供更有信息量的反馈。

## --video-solution--

3

## --text--

当必填输入字段为空时，`validity` 对象的哪个属性变为 true？

## --answers--

`isEmpty`

### --feedback--

本课在记录空必填字段的 `validity` 对象时显示此属性。

---

`required`

### --feedback--

本课在记录空必填字段的 `validity` 对象时显示此属性。

---

`valueMissing`

---

`invalidValue`

### --feedback--

本课在记录空必填字段的 `validity` 对象时显示此属性。

## --video-solution--

3
