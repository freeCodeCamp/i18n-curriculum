---
id: 67d2f7cf63fafe7d20270498
title: 你如何使用 Performance Web APIs 来创建你自己的性能测量工具？
challengeType: 19
dashedName: how-can-you-use-performance-web-apis-to-create-your-own-performance-measurement-tools
---

# --description--

虽然像 Lighthouse 和 Chrome DevTools 这样的工具很棒，但有时你需要为你的网站量身定制的自定义洞察。

这就是 Performance Web APIs 派上用场的地方！

在本课中，我们将详细讲解如何使用三个关键的 Web API 来测量和分析你的网站速度。

但首先，什么是 Performance Web APIs？ 

性能 Web API 让开发者能够直接从代码中跟踪网页的装载和响应效率。这些 API 允许你测量页面装载时间、跟踪渲染和交互延迟以及分析 JavaScript 执行时间。

使用这些 API，你可以构建自己的性能监控工具，而无需依赖第三方软件！

让我们探索你今天可以使用的三个强大 Web API。

首先是 `performance.now()`。

此 API 为你提供高查准率的时间戳（以毫秒为单位），用于测量你网站不同部分的装载时间。

假设你想测量一个函数运行的速度：

```js
const start = performance.now();  
// Run some code here  
const end = performance.now();  

console.log(`Execution time: ${end - start}ms`);
```

这比使用 `Date.now()` 更准确，因为它以微秒查准率测量毫秒时间，避免了时钟漂移问题。你可以用它来跟踪脚本执行时间、事件响应延迟和动画性能。

接下来，Performance Timing API。

此 API 为你提供页面装载每个阶段的详细信息，从 DNS 查询到 `DOMContentLoaded`。

想要测量你的页面完全 `load` 所需的时间吗？

```js
let [navigationTiming] = performance.getEntriesByType("navigation");

if (navigationTiming instanceof PerformanceNavigationTiming) {
  // Calculate time from navigation start to DOM content loaded
  const pageLoadTime =
    navigationTiming.domContentLoadedEventEnd - navigationTiming.startTime;

  console.log("DOM Content Loaded Time:", pageLoadTime, "ms");
}
```

你可以通过此 API 跟踪的关键指标包括 DNS 查找时间——换句话说即连接速度，首次字节时间（TTFB）——即服务器响应速度，以及 `DOMContentLoaded`——换句话说，即页面准备好交互的时间。

如果你的页面装载时间很慢，这个 API 能准确定位延迟发生的位置！

最后，让我们谈谈 `PerformanceObserver`。

此 API 监听诸如版型偏移、长任务和用户交互等性能事件。

想要监控长时间运行的 JavaScript 任务？

```js
const observer = new PerformanceObserver((list) => {  
  list.getEntries().forEach((entry) => {  
    console.log(`Long task detected: ${entry.duration}ms`);  
  });  
});  

observer.observe({ type: "longtask", buffered: true });
```

那么这个 API 能跟踪什么？它可以跟踪长任务——换句话说，就是阻塞渲染的 JavaScript、用于检测界面卡顿的版型移动，以及首次输入延迟（FID）——即页面响应用户输入的速度。

如果你想要实时性能跟踪，这个 API 是游戏规则的改变者。

那么，你应该使用哪个 API 呢？以下是一个快速比较：

| Performance API        | Best For                                           |
| :--------------------- | :------------------------------------------------- |
| `performance.now()`    | Precise timing of functions and scripts            |
| Performance Timing API | Measuring full page load performance               |
| Performance Observer   | Real-time monitoring of interactions and rendering |

通过结合这些 API，你可以构建自己的性能测量工具，并准确跟踪对你的网站最重要的内容。

# --questions--

## --text--

使用 `performance.now()` 相对于 `Date.now()` 的主要优势是什么？

## --answers--

它更准确，并以微秒查准率测量毫秒级时间。

---

它仅在移动设备上工作，不支持桌面端。

### --feedback--

考虑为什么查准率在测量速度时很重要。

---

它测量系统内存使用情况，包括浏览器的内存占用。

### --feedback--

考虑为什么查准率在测量速度时很重要。

---

它有助于 CSS 动画。

### --feedback--

考虑为什么查准率在测量速度时很重要。

## --video-solution--

1

## --text--

哪个 API 可以跟踪导致你的网站变慢的长时间 JavaScript 任务？

## --answers--

性能计时 API

### --feedback--

考虑一个实时监听性能事件的 API。

---

`Performance.now()`

### --feedback--

考虑一个实时监听性能事件的 API。

---

性能观察器

---

PageSpeed Insights

### --feedback--

考虑一个实时监听性能事件的 API。

## --video-solution--

3

## --text--

Performance Timing API 帮助测量什么？

## --answers--

单个 JavaScript 函数执行时间。

### --feedback--

考虑一个跟踪页面装载每个阶段的 API。

---

完整页面装载性能，包括 DNS 查询和 TTFB。

---

用户交互，如按钮点击。

### --feedback--

考虑一个跟踪页面装载每个阶段的 API。

---

网页上的图像数量。

### --feedback--

考虑一个跟踪页面装载每个阶段的 API。

## --video-solution--

2
