---
id: 67d2f5f19a0f0b75343f1905
title: 什麼是 React 伺服端組件，以及它們如何運作？
challengeType: 19
dashedName: what-are-react-server-components-and-how-do-they-work
---

# --description--

React Server Components（RSCs）是一種改變 React 開發者處理方式的新趨勢。使用 RSCs，更多工作會轉移到伺服端，這帶來許多利益。

讓我們來看看什麼是伺端組件、它們如何運作，以及促使伺端組件被引入的原因。

React Server Components 是專門在伺服器端呈現的 React 組件，伺服器僅將最終的 HTML 傳送到客戶端。這表示那些組件可以直接存取伺服器端資源，並大幅減少傳送到瀏覽器的 JavaScript 數量。

React 應用程式傳統上使用一種「客戶端組件」系統，該系統控制典型 React 應用程式中的所有事務，例如算繪、互動性和副作用。直到最近引入 React 伺服端組件之前，「客戶端組件」這個術語很少被使用。

但是客戶端組件系統有一些缺點，例如大型的 JavaScript 套件和較慢的初始載入時間。

像 Next.js 和 Gatsby 這類 React 框架找到了解決方法，將部分處理程序卸載到伺端以修正那些問題，但它們都沒有標準化。如果你使用過任一框架，你可能聽過 `getServerSideProps` 和 `getServerData`。

接著出現了 React Server Components，它讓你可以將某些組件完全在伺服端執行，這樣你就能在任何程式碼於使用者瀏覽器中執行之前，先進行資料擷取和運算等操作。

伺服端組件最初在 Next.js 中普及並且隨時可用。其他框架如 Remix 和 Gatsby 正在追趕，並且有一個名為 `vite-plugin-react-server` 的實驗性外掛程式，讓你可以建置伺服端組件。

那麼伺服端組件如何運作？

展示 React Server Components 最佳方式之一是使用資料擷取。

在傳統的 React 客戶端組件中，你讓瀏覽器控制代碼 API 請求。由於資料擷取是副作用，你會在 `useEffect` 掛鉤中進行該 API 呼叫。

設定像是 loading、data 和 error 這類狀態變數也是良好的做法，這樣你就可以顯示資料正在載入、在資料準備好時顯示資料，或是在你的應用程式中顯示錯誤。

使用 React Server Components，你可以將整個組件移動到伺服端並在那裡擷取資料，而不必使用 `useState` 或 `useEffect`：

```jsx
const Users = async () => {
  const res = await fetch("https://jsonplaceholder.typicode.com/users");
  const users = await res.json();

  return (
    <>
      <h1 className="text-4xl text-center mt-6">Users</h1>
      <ul className="text-center mt-3">
        {users.map((user) => (
          <li key={user.id}>{user.name}</li>
        ))}
      </ul>
    </>
  );
};

export default Users;
```

因為 React Server Components 僅在伺服端執行，你可以直接從 API 取得資料並只算繪一次。此外，由於資料擷取發生在較接近原始碼的伺服端，你的應用程式效能可能會更好，尤其是對於網路連線較慢的人。

一個主要的陷阱是所有伺服端組件的程式碼都保留在伺服端，並不會被傳送到瀏覽器。這表示你無法對它們使用 React 掛鉤，且它們無法存取 Web API 或瀏覽器事件監聽器。那麼你該如何為它們添加互動性？

在 Next.js 的應用程式路由中，所有組件預設都是伺服端組件。如果你想為組件添加互動性，你需要使用 `"use client"` 指令將組件標記為客端組件。

假設你想將前面的範例做成一個客戶端組件。以下是你可以這樣做的方法：

```jsx
"use client";

import { useState, useEffect } from "react";

const Users2 = () => {
  const [status, setStatus] = useState({
    users: [],
    loading: true,
    error: null,
  });

  async function fetchUsers() {
    try {
      const res = await fetch("https://jsonplaceholder.typicode.com/users");
      const data = await res.json();
      setStatus((prevStatus) => ({
        ...prevStatus,
        users: data,
        loading: false,
      }));
    } catch (err) {
      setStatus((prevStatus) => ({
        ...prevStatus,
        error: err.message,
        loading: false,
      }));
    }
  }

  useEffect(() => {
    fetchUsers();
  }, []);

  if (status.loading) {
    return <p>Loading Users...</p>;
  }
  if (status.error) {
    return <p>Error getting users: {status.error}</p>;
  }

  return (
    <>
      <h1 className="text-4xl text-center mt-6">Users</h1>
      <ul className="text-center mt-3">
        {status.users.map((user) => (
          <li key={user.id}>{user.name}</li>
        ))}
      </ul>
    </>
  );
};

export default Users2;
```

如果你想添加像點擊事件這樣的互動性，該組件也必須標記為客戶端組件：

```jsx
"use client";

import { useState } from "react";

const Counter = () => {
  const [count, setCount] = useState(0);

  return (
    <>
      <h1>Counter</h1>
      <button onClick={() => setCount(count + 1)}>Increment</button>
      <h2>{count}</h2>
      <button onClick={() => setCount(count - 1)}>Decrement</button>
    </>
  );
};

export default Counter;
```

如果你沒有為組件添加 `use client` 指令，你會收到一個錯誤，訊息顯示「你正在匯入一個需要 `useState` 的伺端組件。這個 React 掛鉤只在客戶端組件中有效。要修正，請在檔案（或其父層）標記 `"use client"` 指令。」

React Server Components 帶來的主要利益是資料擷取變得更簡單、程式碼更易讀，且減少了客戶端的複雜度。

# --questions--

## --text--

React Server 組件在哪裡執行？

## --answers--

僅限於瀏覽器中。

### --feedback--

請思考 `RSCs` 如何不在瀏覽器中執行，並用於預先呈現資料。

---

在客戶端和伺服端。

### --feedback--

請思考 `RSCs` 如何不在瀏覽器中執行，並用於預先呈現資料。

---

完全在伺服端。

---

在 Web Worker 中。

### --feedback--

請思考 `RSCs` 如何不在瀏覽器中執行，並用於預先呈現資料。

## --video-solution--

3

## --text--

為什麼 React 伺服端組件無法存取 React 掛鉤和 Web API？

## --answers--

它們會在瀏覽器載入之前呈現。

### --feedback--

這些組件從不在瀏覽器中執行，因此它們無法使用客戶端特性。

---

它們僅在伺服端執行，且不會被傳送到瀏覽器。

---

它們受限於 React 的呈現週期。

### --feedback--

這些組件從不在瀏覽器中執行，因此它們無法使用客戶端特性。

---

它們僅用於樣式目的。

### --feedback--

這些組件從不在瀏覽器中執行，因此它們無法使用客戶端特性。

## --video-solution--

2

## --text--

在使用 app router 時，如何為 Next.js 中的組件添加互動性？

## --answers--

將組件包裹在 `<ClientProvider>` 頁籤中。

### --feedback--

Next.js 假設所有組件都是伺服端組件，除非有明確的說明。

---

使用 Next.js 的 `withClient()` 函式（程式）。

### --feedback--

Next.js 假設所有組件都是伺服端組件，除非有明確的說明。

---

在 `next.config.js` 中啟用客戶端呈現。

### --feedback--

Next.js 假設所有組件都是伺服端組件，除非有明確的說明。

---

使用 "use client" 指令將組件標記為客戶端組件。

## --video-solution--

4
