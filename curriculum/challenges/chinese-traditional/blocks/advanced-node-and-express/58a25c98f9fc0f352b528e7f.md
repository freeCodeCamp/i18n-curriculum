---
id: 58a25c98f9fc0f352b528e7f
title: 對你的密碼進行雜湊
challengeType: 2
forumTopicId: 301553
dashedName: hashing-your-passwords
---

# --description--

回到資訊安全部分，你可能還記得儲存明文密碼*絕對*不行。現在是時候實作 `BCrypt` 來解決這個問題。

`bcrypt@~5.0.0` 已經被添加為相依性，所以請在你的伺端中 require 它。你需要在兩個主要區域控制雜湊：處理註冊/儲存新帳號的地方，以及在登入時檢查密碼是否正確的地方。

目前在你的註冊路由中，你將使用者的明文密碼插入資料庫，如：`password: req.body.password`。請改為在你的資料庫邏輯之前加入以下程式碼來對密碼進行雜湊：`const hash = bcrypt.hashSync(req.body.password, 12);`，並將資料庫儲存中的 `req.body.password` 替換為 `password: hash`。

在你的驗證策略中，你會在完成處理程序之前，在程式碼中檢查以下內容：`if (password !== user.password) return done(null, false);`。在進行先前的更改後，現在 `user.password` 是一個雜湊值。在更改現有程式碼之前，請注意該述語是如何檢查密碼是否**不**相等，然後傳回未通過驗證。考慮到這點，請將該程式碼更改為以下內容，以正確檢查輸入的密碼與雜湊值是否相符：

```js
if (!bcrypt.compareSync(password, user.password)) { 
  return done(null, false);
}
```

當你必須儲存密碼時，這就是實作其中一個最重要安全特性所需的一切。

當你認為已經正確完成時，提交你的頁面。如果你遇到錯誤，你可以<a href="https://forum.freecodecamp.org/t/advanced-node-and-express/567135#hashing-your-passwords-1" target="_blank" rel="noopener noreferrer nofollow">查看至此為止完成的專案</a>。

# --hints--

BCrypt 應該是一個相依性。

```js
  const url = new URL("/_api/package.json", code);
  const res = await fetch(url);
  const packJson = await res.json()
  assert.property(
    packJson.dependencies,
    'bcrypt',
    'Your project should list "bcrypt" as a dependency'
  );
```

BCrypt 應該被正確地 require 並實作。

```js
  const url = new URL("/_api/server.js", code);
  const res = await fetch(url);
  const data = await res.text();
  assert.match(
    data,
    /require.*("|')bcrypt\1/gi,
    'You should have required bcrypt'
  );
  assert.match(
    data,
    /bcrypt.hashSync/gi,
    'You should use hash the password in the registration'
  );
  assert.match(
    data,
    /bcrypt.compareSync/gi,
    'You should compare the password to the hash in your strategy'
  );
```

