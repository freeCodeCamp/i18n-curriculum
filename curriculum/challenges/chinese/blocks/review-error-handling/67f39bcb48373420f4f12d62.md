---
id: 67f39bcb48373420f4f12d62
title: 误差处理回顾
challengeType: 31
dashedName: review-error-handling
---

# --description--

## Python 中的常见误差

- **SyntaxError**：当你的代码不符合其语法规则时，Python 引起的误差。例如，代码 `print("Hello there"` 会导致带有消息 `SyntaxError: '(' was never closed` 的语法误差，因为代码缺少一个闭合的括号。
- **NameError**：当你尝试访问未定义的变量或函数时，Python 会引起 `NameError`。例如，如果你的代码中有一行 `print(username)`，但没有先定义 `username` 变量，你将收到带有消息 `NameError: name 'username' is not defined` 的名称错误。
- **TypeError**：当你对两个或多个不兼容的数据类型执行操作时，Python 会抛出此误差。例如，如果你尝试将字串添加到数字，你将得到误差 `TypeError: can only concatenate str (not "int") to str`。
- **IndexError**：如果你访问列表或其他序列如元组和字串中不存在的索引，就会得到一个 `IndexError`。例如，在一个 `Hello world` 字串中，最后一个字符的索引是 `11`。如果你继续这样访问字符，`greet = "hello world"; print(greet[12])`，你将得到一条消息为 `IndexError: string index out of range` 的错误。
- **AttributeError**：当你尝试在该类型的对象中使用不存在的方法或属性时，Python 会引起此误差。例如，在字串上调用 `.append()`，如 `"hello".append("!")`，将导致带有消息 `AttributeError: 'str' object has no attribute 'append'` 的误差。

## Python 中的良好调试技巧

- **使用 `print` 函数**：在调试时，在代码的各个点插入 `print()` 语句可以帮助你查看变量的值以及代码的执行流程。
- **使用 Python 的内置调试器 (`pdb`)**：Python 提供了一个用于调试的 `pdb` 模块。它是 Python 标准函数库的一部分，因此始终可用。通过 `pdb`，你可以使用 `set_trace()` 方法设置追踪，从而以交互方式开始逐步执行代码并检查变量。
- **利用集成开发环境调试工具**：许多集成开发环境（IDE）和代码编辑器如 Pycharm 和 VS Code 提供带有断点、逐步执行、变量检查及其他调试功能的调试工具。

## 异常处理

- **`try...except`**: This is used to execute a block of code that might raise an exception. The `try` block is  where you anticipate an error might occur, while the `except` block takes a specified exception and runs if that specified error is raised. Here's an example:

  ```py
  try:
    print(22 / 0)
  except ZeroDivisionError:
    print('You can\'t divide by zero!')
    # You can't divide by zero!
  ```

  You can also chain multiple `except` blocks so you can handle more types of exceptions:

  ```py
  try:
    number = int(input('Enter a number: '))
    print(22 / number)
  except ZeroDivisionError:
    print('You cannot divide by zero!')
    # You cannot divide by zero! prints when you enter 0
  except ValueError:
    print('Please enter a valid number!')
    # Please enter a valid number! prints when you enter a string  
  ```

- **`else` 和 `finally`**：这些块扩展了 `try...except`。如果没有发生异常，`else` 块将运行。无论是否有误差，`finally` 块总是运行。

  ```py
  try:
    result = 100 / 4
  except ZeroDivisionError:
    print('You cannot divide by zero!') # This will not run
  else:
    print(f'Result is {result}') # Result is 25.0
  finally:
    print('Execution complete!') # Execution complete!
  ```

- **异常对象**：这让你能够访问异常本身，以便更好地调试和打印直接的错误信息。要访问异常对象，你需要使用 `as` 关键字。以下是一个示例：

  ```py
  try:
      value = int('This will raise an error')
  except ValueError as e:
      print(f'Caught an error: {e}')
      # Caught an error: invalid literal for int() with base 10: 'This will raise an error'
  ```

- **`raise` 语句**：这允许你手动引起一个异常。当满足某个条件时，你可以使用它来抛出异常。下面是一个示例：

  ```py
  def divide(a, b):
      if b == 0:
          raise ZeroDivisionError('You cannot divide by zero')
      return a / b
  ```
  
## 异常信号
  
  `raise` 语句在你创建自己的自定义异常时也很有用，因为你可以使用它来抛出带有自定义消息的异常。下面是一个示例：

  ```py
  class InvalidCredentialsError(Exception):
      def __init__(self, message="Invalid username or password"):
          self.message = message
          super().__init__(self.message)

  def login(username, password):
      stored_username = "admin"
      stored_password = "password123"
      
      if username != stored_username or password != stored_password:
          raise InvalidCredentialsError()
      
      return f"Welcome, {username}!"
  ```  

  以下是如何使用来自 `InvalidCredentialsError` 异常的 `login` 函数：

  ```py
  # failed login attempt
  try:
      message = login("user", "wrongpassword")
      print(message)
  except InvalidCredentialsError as e:
      print(f"Login failed: {e}")

  # successful login attempt
  try:
      message = login("admin", "password123")
      print(message)
  except InvalidCredentialsError as e:
      # This block is not executed because the login was successful
      print(f"Login failed: {e}")
  else:
      # The else block runs if the 'try' block completes without an exception
      print(message)
  ```

  `raise` 语句也可以与 `from` 关键字一起使用，以链接异常，显示不同误差之间的关系：

  ```py
  def parse_config(filename):
    try:
        with open(filename, 'r') as file:
            data = file.read()
            return int(data)
    except FileNotFoundError:
        raise ValueError('Configuration file is missing') from None
    except ValueError as e:
        raise ValueError('Invalid configuration format') from e

  config = parse_config('config.txt')
  ```

# --assignment--

查看 `Error Handling` 主题和概念。
